

library(DESeq2)
library(magrittr)

readcounts <-
  read.table('data/featCounts_Gierlinski_genes.txt',
             header = TRUE)

orig_names <- names(readcounts)
names(readcounts) <-
  gsub(".*(WT|SNF2)(_[0-9]+).*", "\\1\\2", orig_names)

## gene IDs should be stored as row.names
row.names(readcounts) <- make.names(readcounts$Geneid)

## exclude the columns without read counts (columns 1 to 6 contain additional
## info such as genomic coordinates)
readcounts <- readcounts[ ,-c(1:6)]

sample_info <- DataFrame(
  condition = gsub("_[0-9]+", "",names(readcounts)),
  row.names =names(readcounts))

DESeq.ds <-DESeqDataSetFromMatrix(
  countData = as.matrix(readcounts),
  colData   = sample_info,
  design    = ~condition)

# Remove genes with no reads
keep_genes <- rowSums(counts(DESeq.ds)) > 0
DESeq.ds <- DESeq.ds[keep_genes, ]

# rlog normalize the data
DESeq.rlog <- rlog(DESeq.ds, blind=TRUE)
rlog.norm.counts <- assay(DESeq.rlog)


  as.dist(1 - cor(rlog.norm.counts, method='pearson')) %>%
  hclust() %>%
  plot(., labels = colnames(rlog.norm.counts),
        main = 'rlog transformed read counts')








